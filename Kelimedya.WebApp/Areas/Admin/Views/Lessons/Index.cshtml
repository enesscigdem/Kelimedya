@model IEnumerable<Kelimedya.WebApp.Areas.Admin.Models.LessonViewModel>

@{
  Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
  ViewData["Title"] = "Dersler";
}

<div class="page-header d-print-none">
  <div class="container-xl">
    <div class="row align-items-center">
      <div class="col">
        <h2 class="page-title">Ders Listesi</h2>
        <div class="text-muted mt-1">
          Seçili eğitime ait dersleri görüntüleyin ve yönetin.
        </div>
      </div>
    </div>
  </div>
</div>

<div class="page-body pt-1">
  <div class="container-xl">
    <div class="row mb-3 align-items-center">
      <div class="col-12 col-lg-4">
        <input type="text" id="searchInput" class="form-control" placeholder="Ders ara..." />
      </div>
      <div class="col-12 col-lg-8 text-end">
        <select id="sortSelect" class="form-select d-inline-block w-auto">
          <option value="">-- Sıralama Seçeneği --</option>
          <option value="titleAsc">Başlık (A - Z)</option>
          <option value="titleDesc">Başlık (Z - A)</option>
          <option value="sequenceAsc">Sıra No (Küçükten Büyüğe)</option>
          <option value="sequenceDesc">Sıra No (Büyükten Küçüğe)</option>
        </select>
      </div>
    </div>
  </div>
</div>

<div class="page-body pt-2">
  <div class="container-xl">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Dersler</h3>
      </div>
      <div class="table-responsive">
        <table class="table card-table table-hover">
          <thead class="table-dark">
            <tr>
              <th>Ders Başlığı</th>
              <th>Açıklama</th>
              <th>Sıra No</th>
              <th>Resim</th>
              <th class="w-1 text-end">İşlemler</th>
            </tr>
          </thead>
          <tbody>
            @foreach (var lesson in Model)
            {
              <tr>
                <td>@lesson.Title</td>
                <td>@lesson.Description</td>
                <td>@lesson.SequenceNo</td>
                <td>
                  @if (!string.IsNullOrEmpty(lesson.ImageUrl))
                  {
                    <img src="@lesson.ImageUrl.ToDriveThumbnail()" alt="Lesson Image" style="max-height:50px;" />
                  }
                </td>
                <td class="text-end">
                  <div class="btn-group" role="group">
                    <a asp-action="Edit" asp-route-id="@lesson.Id" class="btn btn-success me-1"
                      title="Düzenle">Düzenle</a>
                    <a asp-action="Delete" asp-route-id="@lesson.Id" class="btn btn-danger delete-btn" title="Sil">Sil</a>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

@section Scripts {
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function () {
      $("#searchInput").on("keyup", function () {
        var value = $(this).val().toLowerCase();
        $("table tbody tr").filter(function () {
          var titleText = $(this).find("td:first").text().toLowerCase();
          var descText = $(this).find("td:eq(1)").text().toLowerCase();
          $(this).toggle(titleText.indexOf(value) > -1 || descText.indexOf(value) > -1);
        });
      });

      $("#sortSelect").on("change", function () {
        var option = $(this).val();
        var rows = $("table tbody tr").get();

        rows.sort(function (a, b) {
          var titleA = $(a).find("td:first").text().toUpperCase();
          var titleB = $(b).find("td:first").text().toUpperCase();
          var sequenceA = parseInt($(a).find("td:eq(2)").text());
          var sequenceB = parseInt($(b).find("td:eq(2)").text());

          switch (option) {
            case "titleAsc":
              return (titleA < titleB) ? -1 : (titleA > titleB) ? 1 : 0;
            case "titleDesc":
              return (titleA > titleB) ? -1 : (titleA < titleB) ? 1 : 0;
            case "sequenceAsc":
              return sequenceA - sequenceB;
            case "sequenceDesc":
              return sequenceB - sequenceA;
            default:
              return 0;
          }
        });

        $.each(rows, function (index, row) {
          $("table tbody").append(row);
        });
      });
    });
  </script>
}
