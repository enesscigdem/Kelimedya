@inject IConfiguration Configuration
@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Satış Grafiği";
}

<div class="page-header d-print-none">
    <div class="container-xl">
        <h2 class="page-title">Satış Grafikleri</h2>
        <div class="text-muted mt-1">
            Son döneme ait çeşitli satış grafikleri.
        </div>
    </div>
</div>

<div class="page-body">
    <div class="container-xl">

        <div class="row row-cards">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Aylık Satışlar</h3>
                    </div>
                    <div class="card-body">
                        <div id="chart-sales-1" style="height: 300px;"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Haftalık Satışlar</h3>
                    </div>
                    <div class="card-body">
                        <div id="chart-sales-2" style="height: 300px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row row-cards mt-3">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Kategori Bazlı Satış</h3>
                    </div>
                    <div class="card-body">
                        <div id="chart-sales-3" style="height: 300px;"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Eğitim Paketleri Satışı</h3>
                    </div>
                    <div class="card-body">
                        <div id="chart-sales-4" style="height: 300px;"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script>
      const API_BASE_URL = '@Configuration["AppSettings:ApiUrl"]';
      document.addEventListener("DOMContentLoaded", function () {
        fetch(`${API_BASE_URL}/monthly`).then(r => r.json()).then(data => {
          var categories = data.map(d => `${d.month}.${d.year}`);
          var totals = data.map(d => d.total);
          var options1 = { chart:{ type:'line', height:300 }, series:[{ name:'Satış', data: totals }], xaxis:{ categories: categories } };
          new ApexCharts(document.querySelector("#chart-sales-1"), options1).render();
        });

        fetch(`${api}/daily`).then(r=>r.json()).then(data => {
          var categories = data.map(d => new Date(d.date).toLocaleDateString('tr-TR',{weekday:'short'}));
          var totals = data.map(d => d.total);
          var options2 = { chart:{ type:'bar', height:300 }, series:[{ name:'Satış', data: totals }], xaxis:{ categories: categories } };
          new ApexCharts(document.querySelector("#chart-sales-2"), options2).render();
        });
      });
    </script>
}
