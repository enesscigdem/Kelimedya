@model List<Kelimedya.WebApp.Areas.Admin.Models.UserViewModel>

@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Kullanıcı Listesi";
}

<div class="page-header d-print-none">
    <div class="container-xl">
        <div class="row g-2 align-items-center">
            <div class="col">
                <h2 class="page-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-users me-1 text-primary"
                         width="28" height="28" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                         stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <path d="M9 7a4 4 0 1 1 6 0a4 4 0 1 1 -6 0"/>
                        <path d="M17 11l2 2l4 -4"/>
                        <path d="M6 21v-2a4 4 0 0 1 4 -4h4"/>
                    </svg>
                    Kullanıcı Listesi
                </h2>
                <div class="text-muted mt-1">
                    Sistemde kayıtlı tüm kullanıcıları buradan yönetebilirsiniz.
                </div>
            </div>
            <div class="col-auto ms-auto d-print-none">
                <a asp-area="Admin" asp-controller="Users" asp-action="Create"
                   class="btn btn-primary d-none d-sm-inline-block">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user-plus me-1"
                         width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                         stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <path d="M8 7a4 4 0 1 1 8 0a4 4 0 1 1 -8 0"/>
                        <path d="M16 19h6"/>
                        <path d="M19 16v6"/>
                        <path d="M6 21v-2a4 4 0 0 1 4 -4h4"/>
                    </svg>
                    Yeni Kullanıcı
                </a>
            </div>
        </div>
    </div>
</div>

<div class="page-body pt-1">
    <div class="container-xl">
        <div class="row row-cards">
            <div class="col-sm-6 col-lg-3">
                <div class="card card-sm">
                    <div class="card-body d-flex align-items-center">
                        <div class="subheader">Admin Sayısı</div>
                        <div class="ms-auto lh-1">
                            <span class="h2 mb-0 text-primary">@Model.Count(u => u.Role == "Admin")</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="card card-sm">
                    <div class="card-body d-flex align-items-center">
                        <div class="subheader">Öğretmen Sayısı</div>
                        <div class="ms-auto lh-1">
                            <span class="h2 mb-0 text-blue">@Model.Count(u => u.Role == "Teacher")</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="card card-sm">
                    <div class="card-body d-flex align-items-center">
                        <div class="subheader">Öğrenci Sayısı</div>
                        <div class="ms-auto lh-1">
                            <span class="h2 mb-0 text-green">@Model.Count(u => u.Role == "Student")</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="card card-sm">
                    <div class="card-body d-flex align-items-center">
                        <div class="subheader">Toplam Kullanıcı</div>
                        <div class="ms-auto lh-1">
                            <span class="h2 mb-0 text-orange">@Model.Count()</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="page-body pt-2">
    <div class="container-xl">
        <div class="row mb-3">
            <div class="col-12 col-lg-4">
                <div class="input-icon">
                    <span class="input-icon-addon">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24"
                             height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                             stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                            <path d="M10 10a7 7 0 1 0 7 7"/>
                            <path d="M21 21l-6 -6"/>
                        </svg>
                    </span>
                    <input type="text" id="searchInput" class="form-control" placeholder="Kullanıcı ara..."/>
                </div>
            </div>
            <div class="col-12 col-lg-8 text-end">
                <select id="sortSelect" class="form-select d-inline-block w-auto me-2">
                    <option value="">-- Sıralama Seçeneği --</option>
                    <option value="nameAsc">Ad Soyad (A - Z)</option>
                    <option value="nameDesc">Ad Soyad (Z - A)</option>
                    <option value="usernameAsc">Kullanıcı Adı (A - Z)</option>
                    <option value="usernameDesc">Kullanıcı Adı (Z - A)</option>
                    <option value="emailAsc">E-posta (A - Z)</option>
                    <option value="emailDesc">E-posta (Z - A)</option>
                    <option value="dateAsc">Kayıt Tarihi (Eskiden Yeniye)</option>
                    <option value="dateDesc">Kayıt Tarihi (Yeniden Eskiye)</option>
                </select>
                <select id="roleFilter" class="form-select d-inline-block w-auto">
                    <option value="">Tüm Roller</option>
                    <option value="Admin">Admin</option>
                    <option value="Teacher">Öğretmen</option>
                    <option value="Student">Öğrenci</option>
                </select>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Kayıtlı Kullanıcılar</h3>
            </div>
            <div class="table-responsive">
                <table class="table card-table table-vcenter table-hover">
                    <thead class="table-dark">
                    <tr>
                        <th>Ad Soyad</th>
                        <th>Kullanıcı Adı</th>
                        <th>Telefon</th>
                        <th>Sınıf</th>
                        <th>E-posta</th>
                        <th>Rol</th>
                        <th>Kayıt Tarihi</th>
                        <th class="w-1 text-end">İşlemler</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var user in Model)
                    {
                        <tr>
                            <td>@user.FullName</td>
                            <td>@user.UserName</td>
                            <td>@user.PhoneNumber</td>
                            <td>
                                @(user.ClassGrade == null || user.ClassGrade == 0 ? "" : user.ClassGrade + ". sınıf")
                            </td>
                            <td>@user.Email</td>
                            <td>
                                @if (user.Role == "Admin")
                                {
                                    <span class="badge bg-red-lt text-red">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="icon icon-tabler icon-tabler-star me-1" width="16" height="16"
                                             viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                             stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path
                                                d="M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z"/>
                                        </svg>
                                        Yönetici
                                    </span>
                                }
                                else if (user.Role == "Teacher")
                                {
                                    <span class="badge bg-blue-lt text-blue">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="icon icon-tabler icon-tabler-chalkboard me-1" width="16" height="16"
                                             viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                             stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M4 3h16v13h-4l-4 5l-4 -5h-4z"/>
                                            <path d="M7 7h1"/>
                                            <path d="M12 7h1"/>
                                            <path d="M15 7h2"/>
                                        </svg>
                                        Öğretmen
                                    </span>
                                }
                                else
                                {
                                    <span class="badge bg-green-lt text-green">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="icon icon-tabler icon-tabler-graduation-cap me-1" width="16" height="16"
                                             viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                             stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M3 7l9 -4l9 4l-9 4l-9 -4v6"/>
                                            <path d="M9 10v4c0 1.38 2.686 2.5 6 2.5s6 -1.12 6 -2.5v-4"/>
                                            <path d="M9 10l9 -4"/>
                                        </svg>
                                        Öğrenci
                                    </span>
                                }
                            </td>
                            <td>@user.CreatedAt.ToString("dd/MM/yyyy")</td>
                            <td class="text-end">
                                <div class="btn-group" role="group">
                                    <a asp-area="Admin" asp-controller="Users" asp-action="Edit" asp-route-id="@user.Id"
                                       class="btn btn-success d-flex align-items-center me-1" title="Düzenle">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="20" height="20"
                                             viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                             stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M8 18h4"/>
                                            <path d="M4 14v4h4l10 -10a2 2 0 1 0 -4 -4z"/>
                                        </svg>
                                        Düzenle
                                    </a>

                                    <a asp-area="Admin" asp-controller="Users" asp-action="Delete"
                                       asp-route-id="@user.Id"
                                       class="btn btn-danger d-flex align-items-center delete-btn" title="Sil">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="20" height="20"
                                             viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                             stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M4 7h16"/>
                                            <path d="M10 11v6"/>
                                            <path d="M14 11v6"/>
                                            <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"/>
                                            <path d="M9 7v-2a1 1 0 0 1 1 -1h4 a1 1 0 0 1 1 1v2"/>
                                        </svg>
                                        Sil
                                    </a>

                                </div>
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Arama işlevi
            $("#searchInput").on("keyup", function () {
                filterTable();
            });

            // Rol filtresi
            $("#roleFilter").on("change", function () {
                filterTable();
            });

            function filterTable() {
                var searchValue = $("#searchInput").val().toLowerCase();
                var selectedRole = $("#roleFilter").val();

                $("table tbody tr").filter(function () {
                    var nameText = $(this).find("td:first").text().toLowerCase();
                    var usernameText = $(this).find("td:eq(1)").text().toLowerCase();
                    var emailText = $(this).find("td:eq(2)").text().toLowerCase();
                    var roleText = $(this).find("td:eq(3)").text().trim();

                    var matchesSearch = nameText.indexOf(searchValue) > -1 ||
                        usernameText.indexOf(searchValue) > -1 ||
                        emailText.indexOf(searchValue) > -1;

                    var matchesRole = !selectedRole || roleText.indexOf(selectedRole) > -1;

                    $(this).toggle(matchesSearch && matchesRole);
                });
            }

            // Sıralama işlevi
            $("#sortSelect").on("change", function () {
                var option = $(this).val();
                var rows = $("table tbody tr").get();

                rows.sort(function (a, b) {
                    var nameA = $(a).find("td:first").text().toUpperCase();
                    var nameB = $(b).find("td:first").text().toUpperCase();
                    var usernameA = $(a).find("td:eq(1)").text().toUpperCase();
                    var usernameB = $(b).find("td:eq(1)").text().toUpperCase();
                    var emailA = $(a).find("td:eq(2)").text().toUpperCase();
                    var emailB = $(b).find("td:eq(2)").text().toUpperCase();
                    var dateA = new Date($(a).find("td:eq(4)").text().split('/').reverse().join('-'));
                    var dateB = new Date($(b).find("td:eq(4)").text().split('/').reverse().join('-'));

                    switch (option) {
                        case "nameAsc":
                            return (nameA < nameB) ? -1 : (nameA > nameB) ? 1 : 0;
                        case "nameDesc":
                            return (nameA > nameB) ? -1 : (nameA < nameB) ? 1 : 0;
                        case "usernameAsc":
                            return (usernameA < usernameB) ? -1 : (usernameA > usernameB) ? 1 : 0;
                        case "usernameDesc":
                            return (usernameA > usernameB) ? -1 : (usernameA < usernameB) ? 1 : 0;
                        case "emailAsc":
                            return (emailA < emailB) ? -1 : (emailA > emailB) ? 1 : 0;
                        case "emailDesc":
                            return (emailA > emailB) ? -1 : (emailA < emailB) ? 1 : 0;
                        case "dateAsc":
                            return dateA - dateB;
                        case "dateDesc":
                            return dateB - dateA;
                        default:
                            return 0;
                    }
                });

                $.each(rows, function (index, row) {
                    $("table tbody").append(row);
                });
            });
        });
    </script>
}